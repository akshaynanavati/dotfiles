#!/usr/bin/env python3

import sys
import re

HELP = '''

'''

def regex_replace():
    fname = sys.argv[2]
    regex = sys.argv[3]
    replace = sys.argv[4]

def inplace_edit():
    fname = sys.argv[2]
    edit_op = sys.argv[3]
    if len(sys.argv) == 4:
        filter_op = lambda a: True
    else:
        filter_op = sys.argv[4]

def run_script():
    setup = ''
    loop = ''
    after = ''
    if len(sys.argv) == 2:
        loop = sys.argv[1]
    elif len(sys.argv) > 2:
        setup = sys.argv[1]
        loop = sys.argv[2]
        after = '' if len(sys.argv) < 4 else sys.argv[3]

    exec(setup)

    for _ in sys.stdin:
        exec(loop)

    exec(after)

def main():
    if '-h' in sys.argv:
        print(HELP)
        return 0

    if sys.argv[1] == 'r':
        regex_replace()
        return 0

    if sys.argv[1] == 'e':
        inplace_edit()
        return 0

    run_script()
    return 0

try:
    sys.exit(main())
except Exception as e:
    print(f"Received exception: {e}")
    print(HELP)
    sys.exit(1)
